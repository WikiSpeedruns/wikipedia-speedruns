{% extends 'base.html' %}

{% block head %}

<link rel="stylesheet" type= "text/css" href="{{url_for('static', filename='stylesheets/wikipedia.css')}}">
<link rel="stylesheet" type= "text/css" href="{{url_for('static', filename='stylesheets/play.css')}}">
<script type="module" src="{{url_for('static', filename='js/play.js')}}"></script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<style>
    [v-cloak] { display: none }
</style>
{% endblock %}

{% block content %}

<div id="app">
<template v-cloak> <!--Top level v-cloak to hide stuff when loading vue-->
    <div v-show="started && !finished">

        <div class="show-on-desktop">
            <div class="HUDwrapper container" id="time-box">
                <div class="row flex-row">
                    <div class="col-sm-3 text-nowrap px-4 pt-2">
                        Start Article<br><strong>[[startArticle]]</strong>
                    </div>
                    <div class="col-sm-3 text-nowrap px-4 pt-2">
                        End Article<br><strong>[[endArticle]] </strong>
                        <small style="cursor: help;" :href="`/wiki/${endArticle}`" @mouseenter="showPreview" @mouseleave="hidePreview">
                            ⓘ
                        </small>
                    </div>
                    <div class="col-sm-3 text-nowrap px-4 pt-2">
                        Links clicked<br><strong>[[path.length - 1]]</strong>
                    </div>
                    <div class="col-sm-3 text-nowrap px-4 pt-2">
                        Time Elapsed<br><strong>[[elapsed.toFixed(3)]] s</strong>
                    </div>
                </div>
                <div class="row flex-row">
                    <div class="col-sm-3 text-nowrap px-4 py-2">
                        Current Article<br><strong>[[currentArticle]]</strong>
                    </div>

                    <div v-if="promptRated" class="col-sm-3 text-nowrap px-4 py-2">
                        Mode: <br>
                        <b class="text-danger" v-if="!promptPlayed && promptActive">Rated</b>
                        <b v-else>Practice</b>
                    </div>
                </div>
            </div>
        </div>

        <div class="show-on-mobile">
            <div class="HUDwrapper-mobile" id="time-box-mobile">
                <div class="HUDwrapper-mobile-inner-container">
                    Start Article: <strong>[[startArticle]]</strong>
                    <br>
                    End Article: <strong>[[endArticle]]</strong>
                    <small style="cursor: help;" :href="`/wiki/${endArticle}`" @click="showPreview">
                        ⓘ
                    </small>
                    <br>
                    Current Article: <strong>[[currentArticle]]</strong>
                    <br>
                    Links clicked: <strong>[[path.length - 1]]</strong>
                    <br>
                    Time Elapsed: <strong>[[elapsed.toFixed(3)]] s</strong>
                </div>
            </div>
        </div>
    </div>

    <div v-if="previewContent">
        <div v-if="eventType === 'click'" class="blocker" @click="hidePreview"></div>
        <page-preview
            :article-preview="previewContent"
            :client-x="eventX"
            :client-y="eventY"
        ></page-preview>
    </div>

    <countdown-timer id="countdown-box"
        v-bind:start-article="startArticle"
        v-bind:end-article="endArticle"
        v-bind:rated-run="promptRated && promptActive && !promptPlayed"
        v-bind:rated-prompt="promptRated"
        v-on:start-game="start"
    ></countdown-timer>

    <!-- TODO its a bit ugly passing all these in, should clean this up-->
    <finish-page
        v-bind:prompt-id="promptId"
        v-bind:lobby-id="lobbyId"
        v-bind:run-id="runId"

        v-bind:start-article="startArticle"
        v-bind:end-article="endArticle"
        v-bind:final-time="endTime - startTime"
        v-bind:path="path"

        v-bind:logged-in="loggedIn"

        v-show="finished"
    ></finish-page>

    <div v-show="started && !finished" id="main">
        <div id="wikipedia-frame" class="main-text"></div>
        <div id="article-end-marker">
            <hr class="mt-5">
            <div class="text-center font-weight-light"><strong>- End of Article -</strong></div>
            <hr class="mb-3">
        </div>
    </div>
</template>
</div>
{% endblock %}
